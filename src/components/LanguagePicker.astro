---
import { languages } from "../i18n/languages";
import { getRelativeLocaleUrl } from 'astro:i18n';

const pathname = Astro.url.pathname || '/';

const pathFor = (targetLang: string) => {
    // Remove leading slashes and split into segments
    const segments = pathname.replace(/^\/+/, '').split('/').filter(Boolean);
    
    // Remove the current language (first segment) and keep the rest
    const rest = segments.slice(1).join('/');
    
    // Use Astro's i18n helper to construct the URL
    return getRelativeLocaleUrl(targetLang, rest);
};
---
<ul>
  {Object.entries(languages).map(([lang, label]) => (
    <li>
      <a href={pathFor(lang)}>{label}</a>
    </li>
  ))}
</ul>