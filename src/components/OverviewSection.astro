---
/**
 * Overview Section Component
 * 
 * Displays the main overview/introduction section of the website.
 * Provides a description of the trail and location information with map.
 * 
 * Props:
 * @param {string} title - Section title
 * @param {string} subtitle - Section subtitle
 * @param {string} description - Main description text
 * @param {string} mapTitle - Map section title
 * @param {string} getDirectionsText - Text for directions link
 * @param {string} getDirectionsUrl - URL for Google Maps directions
 */

export interface Props {
	title: string;
	subtitle: string;
	description: string;
	mapTitle: string;
	getDirectionsText: string;
	getDirectionsUrl: string;
	class?: string;
}

const { title, subtitle, description, mapTitle, getDirectionsText, getDirectionsUrl, class: className } = Astro.props;
---

<section id="overview" class:list={["section", className]}>
	<div class="container-custom">
		<div class="section-header">
			<h2 class="section-title">{title}</h2>
			<p class="section-subtitle">{subtitle}</p>
		</div>

		<div class="grid md:grid-cols-2 gap-8 lg:gap-12 mt-12">
			<!-- Left Column: Description -->
			<div class="flex flex-col justify-center">
				<p class="text-lg leading-relaxed text-[var(--color-text)]">{description}</p>
			</div>

			<!-- Right Column: Map -->
			<div class="flex flex-col">
				<h3 class="text-2xl font-serif font-bold text-[var(--color-text)] mb-6">{mapTitle}</h3>
				
				<!-- OpenStreetMap with Leaflet -->
				<div id="overview-map" class="relative w-full h-[400px] rounded-xl overflow-hidden shadow-lg mb-4"></div>

				<!-- Get Directions Link -->
				<a 
					href={getDirectionsUrl}
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-2 text-[var(--color-primary-600)] hover:text-[var(--color-primary-700)] font-medium transition-colors"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
					</svg>
					{getDirectionsText}
				</a>
			</div>
		</div>
	</div>
</section>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<!-- Leaflet JS -->
<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script>
	// Initialize map when DOM is ready
	document.addEventListener('DOMContentLoaded', function() {
		// Saint Ruffino coordinates (Amandola, Marche)
		const saintRuffinoCoords = [42.965, 13.357];
		
		// Initialize map centered on Italy with zoom showing entire country
		const map = L.map('overview-map').setView([42.5, 12.5], 6);
		
		// Add OpenStreetMap tiles (free, no limits)
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
			maxZoom: 19
		}).addTo(map);
		
		// Create custom icon for the pin
		const customIcon = L.icon({
			iconUrl: 'data:image/svg+xml;base64,' + btoa(`
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="40" height="40">
					<path fill="#8B4513" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
					<circle cx="12" cy="9" r="2.5" fill="white"/>
				</svg>
			`),
			iconSize: [40, 40],
			iconAnchor: [20, 40],
			popupAnchor: [0, -40]
		});
		
		// Add marker for Saint Ruffino with popup
		const marker = L.marker(saintRuffinoCoords, { icon: customIcon }).addTo(map);
		marker.bindPopup('<b>San Ruffino</b><br>Amandola, Marche, Italy').openPopup();
		
		// Add pulsing circle overlay around the pin
		const circle = L.circle(saintRuffinoCoords, {
			color: '#8B4513',
			fillColor: '#8B4513',
			fillOpacity: 0.2,
			radius: 5000 // 5km radius
		}).addTo(map);
	});
</script>

<style>
	/* Ensure map renders properly */
	#overview-map {
		z-index: 0;
	}
	
	/* Style the popup */
	:global(.leaflet-popup-content-wrapper) {
		border-radius: 8px;
		font-family: var(--font-sans);
	}
	
	:global(.leaflet-popup-content) {
		margin: 10px 15px;
		font-size: 14px;
	}
</style>
