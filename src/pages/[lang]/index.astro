---
// Main index homepage (language-specific)

import { getCollection } from "astro:content";
import { languages } from "../../i18n/languages";
import { useTranslations } from "../../i18n/utils";
import BaseLayout from "../../layouts/Base.astro";
import HeroCarousel from "../../components/HeroCarousel.astro";
import OverviewSection from "../../components/OverviewSection.astro";
import TrailsSection from "../../components/TrailsSection.astro";
import SaintsSection from "../../components/SaintsSection.astro";
import ReviewsSection from "../../components/ReviewsSection.astro";
import BookingSection from "../../components/BookingSection.astro";
import "../../styles/global.css";

export function getStaticPaths() {
	// converts languages object keys into an array of lang params
	return Object.keys(languages).map((lang) => ({
		params: { lang },
	}));
}

const { lang } = Astro.params;
const t = useTranslations(lang as keyof typeof languages);

// Get all trails for this language
const allTrails = await getCollection("trails", ({ id }) => {
	return id.startsWith(`${lang}/`);
});

// Get all saints for this language
const allSaints = await getCollection("saints", ({ id }) => {
	return id.startsWith(`${lang}/`);
});

// Sample reviews (in real app, these would come from a database or CMS)
const sampleReviews = [
	{
		name: "Marco Rossi",
		location: "Milano, Italy",
		rating: 5,
		date: "November 2024",
		text: t('reviews.sample1.text')
	},
	{
		name: "Anna Weber",
		location: "Munich, Germany",
		rating: 5,
		date: "October 2024",
		text: t('reviews.sample2.text')
	},
	{
		name: "Sarah Johnson",
		location: "London, UK",
		rating: 4,
		date: "September 2024",
		text: t('reviews.sample3.text')
	}
];

// Booking options
const bookingOptions = [
	{
		title: t('booking.individual'),
		description: t('booking.individualDesc'),
		features: [
			t('booking.feature.mapsGuide'),
			t('booking.feature.support247'),
			t('booking.feature.accommodationBooking'),
		]
	},
	{
		title: t('booking.group'),
		description: t('booking.groupDesc'),
		features: [
			t('booking.feature.expertGuide'),
			t('booking.feature.groupMax12'),
			t('booking.feature.guidedVisits'),
			t('booking.feature.insuranceIncluded'),
		]
	},
	{
		title: t('booking.premium'),
		description: t('booking.premiumDesc'),
		features: [
			t('booking.feature.privateGuide'),
			t('booking.feature.premiumAccommodation'),
			t('booking.feature.mealsIncluded'),
			t('booking.feature.luggageTransfer'),
			t('booking.feature.postTrekMassage'),
		]
	}
];
---

<BaseLayout>
	<!-- Hero Carousel -->
	<HeroCarousel 
		title={t('hero.title')}
		subtitle={t('hero.subtitle')}
		ctaText={t('hero.cta')}
		ctaLink={`#overview`}
	/>

	<!-- Overview Section -->
	<div class="section-spacing-lg">
		<OverviewSection
			title={t('overview.title')}
			subtitle={t('overview.subtitle')}
			description={t('overview.description')}
			locationLabel={t('overview.location')}
			locationText={t('overview.locationText')}
		/>
	</div>

	<!-- Trails Section -->
	<div class="section-spacing-lg">
		<TrailsSection
			title={t('trails.title')}
			subtitle={t('trails.subtitle')}
			trails={allTrails}
			lang={lang}
			translations={{
				distance: t('trails.distance'),
				duration: t('trails.duration'),
				difficulty: t('trails.difficulty'),
				viewDetails: t('trails.viewDetails'),
				easy: t('trails.difficulty.easy'),
				moderate: t('trails.difficulty.moderate'),
				hard: t('trails.difficulty.hard')
			}}
		/>
	</div>

	<!-- Saints Section -->
	<div class="section-spacing-lg">
		<SaintsSection
			title={t('saints.title')}
			subtitle={t('saints.subtitle')}
			saints={allSaints}
			lang={lang}
			translations={{
				learnMore: t('saints.learnMore')
			}}
		/>
	</div>

	<!-- Reviews Section -->
	<div class="section-spacing-lg">
		<ReviewsSection
			title={t('reviews.title')}
			subtitle={t('reviews.subtitle')}
			reviews={sampleReviews}
		/>
	</div>

	<!-- Booking Section -->
	<section id="booking" class="section section-spacing-lg">
		<div class="container-custom">
			<BookingSection
				title={t('booking.title')}
				subtitle={t('booking.subtitle')}
				options={bookingOptions}
				contactText={t('booking.contactUs')}
				contactLink="#"
			/>
		</div>
	</section>
</BaseLayout>
